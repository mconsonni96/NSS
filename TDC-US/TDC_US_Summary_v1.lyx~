#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass IEEEtran
\begin_preamble
% for subfigures/subtables
\usepackage[caption=false,font=footnotesize]{subfig}
%\pagenumbering{gobble}
\renewcommand\toprule{\hline\hline}
\renewcommand\bottomrule{\hline\hline}
\end_preamble
\options journal
\use_default_options false
\maintain_unincluded_children false
\language english
\language_package none
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command bibtex
\index_command default
\float_placement tbh
\paperfontsize default
\spacing single
\use_hyperref true
\pdf_title "Extremely-high speed Time-to-Digital converter on latest generation Field Programmable Gate Arrays for mission-critical applications"
\pdf_author "Nicola Corna"
\pdf_bookmarks false
\pdf_bookmarksnumbered true
\pdf_bookmarksopen true
\pdf_bookmarksopenlevel 1
\pdf_breaklinks false
\pdf_pdfborder true
\pdf_colorlinks false
\pdf_backref false
\pdf_pdfusetitle false
\pdf_quoted_options "pdfpagelayout=OneColumn, pdfnewwindow=true, pdfstartview=XYZ, plainpages=false"
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 2
\papersides 1
\paperpagestyle headings
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
High-Performance Time-to-Digital Converter IP-Core for Xilinx UltraScale+
 FPGAs
\end_layout

\begin_layout Author
N.
 Lusardi, F.
 Garzetti, N.
 Corna, S.
 Salgaro, N.
 Bachetti, A.
 Geraci
\begin_inset Foot
status open

\begin_layout Plain Layout
Manuscript received May 6, 2019.
 All authors are with the Politecnico di Milano, Department of Electronics,
 Information and Bioengineering – DEIB, via Golgi 40, 20133 Milano MI, Italy
 (nicola.lusardi@polimi.it).
 detail
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
pagestyle{headings}
\end_layout

\end_inset


\end_layout

\begin_layout Keywords
Time-of-Flight Positron Emission Tomography (PET-TOF), Time-to-Digital Converter
 (TDC), Tapped Delay-Line (TDL), Virtual Tapped Delay-Line (V-TDL), Field
 Programmable Gate Array (FPGA), thermometric-to-binary converter, decoder,
 Calibration Table (CT).
\end_layout

\begin_layout Section
Summary 
\end_layout

\begin_layout Standard
\begin_inset Flex Paragraph Start
status open

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
I
\end_layout

\end_inset

n
\end_layout

\end_inset

 recent years, one of the scientific research sector in which there has
 been a lot of interest and progress is the study of temporal evolution
 of chemical-physical phenomena, occurring in the picosecond time scale.
 Some examples of these phenomena are Time-of-Flight Positron Emission Tomograph
y (PET-TOF), time-resolved spectroscopy and Laser Rangefinding.
 In these experiments, researchers not only want to know the time in which
 a certain phenomenon occurs, but they also want to correlate a main event,
 sometimes even down into the picosecond or femtosecond scale, with other
 related events.
 This has led to the integration of an instrument in the acquisition system,
 which is able to discriminate the arrival time of multiple events on different
 channels.
 The main features demanded to this type of detector are, thus, high spatial
 and time resolution, high precision in the measurement, and high count
 rate capability.
 All of this can be managed by the Time-to-Digital Converter (TDC).
 
\end_layout

\begin_layout Standard
This device can be implemented both in ASIC or in FPGA.
 We chose this second option because the FPGA, with respect to the ASIC,
 has the great advantage of high reconfigurability and low non-recurring
 costs (NRE), together with the portability and tunability given by a user-frien
dly IP-Core packaging.
\end_layout

\begin_layout Standard
In this contribution, we have modified the dynamic TDC IP-Core, in order
 to adapt it to Xilinx UltraScale and UltraScale+ FPGAs.
 The result is a totally tunable TDL-based, plug-and-play, TDC IP-Core,
 with an increase in performances and better accuracy, precision and reduced
 dead-time with respect to previous releases.
 The architecture of the TDL-TDC has been modified inserting the Xilinx
 CARRY8 primitive in substitution of the CARRY4 of the previous 7-Series
 version.
\end_layout

\begin_layout Standard
The calculation of the timestamp on a single channel is made using Nutt
 Interpolation, which composes the data by a Coarse part and a Fine part.
 This allows to have high resolution and high FSR at the same time (Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Nutt-Interpolation."
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figure/Nutt.png
	width 100col%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Nutt Interpolation.
\begin_inset CommandInset label
LatexCommand label
name "fig:Nutt-Interpolation."

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The coarse contribution is obtained by sampling a BIT_COARSE-bit wide counter
 clocked at 
\begin_inset Formula $T_{CLK}$
\end_inset

.
 This part determines the FSR of the timestamp (Equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:FSR-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
FSR=T_{CLK}\cdot2^{BIT\_COARSE}\label{eq:FSR-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The fine contribution splits the period 
\begin_inset Formula $T_{CLK}$
\end_inset

 into 
\begin_inset Formula $2^{BIT\_RES}$
\end_inset

 steps by means of 
\begin_inset Formula $N_{TDL}$
\end_inset

 TDLs that works in parallel.
 This technique allows to sub-interpolate the TDLs using the Super Wave
 Union algorithm, creating a Virtual TDL (V-TDL) composed of 
\begin_inset Formula $N_{V}$
\end_inset

 so-called virtual taps, as reported in Equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:virtual_bins"
plural "false"
caps "false"
noprefix "false"

\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
N_{V}=N_{TDL}\cdot N_{TAP}\label{eq:virtual_bins}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
BIT\_RES=\log_{2}(N_{V})\label{eq:BIT_RES-1}
\end{equation}

\end_inset

splitting the ultra-bin of a single TDL so to have more precision in the
 measure.
 The fine part determines the LSB of the timestamp (Equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:LSB-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

): 
\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{equation}
LSB=\frac{T_{CLK}}{2^{BIT\_RES}}\label{eq:LSB-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Concerning the design, each one of the TDLs is implemented using the carry-chain
s available inside the Configurable Logic Blocks (CLBs) of the FPGAs.
 Being this an implementation on Ultrascale/Ultrascale+ FPGA, we exploited
 the CARRY8 primitive.
 When a fine measure is performed, each TDLs generate as output a thermometric
 code, which is then converted in a binary value by a decoder.
 After the decoder, the Coarse Extension Core (CEC) appends the coarse part
 to the fine one.
 This module also contains a FIFO that has buffering and Cross-Domain Clock
 (CDC) functions, allowing each channel to sustain a maximum measure rate
 of 200 Msps.
 The last function performed by the CEC is to keep track of the overflows
 of the coarse counter, which are then counted by one of the following module,
 the Overflow Counter (OC).
 Counting the overflows allows to extend the FSR up to some days.
 In order to guarantee a low integral non-linearity error due to temperature
 and process variations, in each channel a “bin-by-bin” calibrator is present.
 Thanks to this module, a Calibration Table (CT) is built, as reported in
 Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Calibration-Table."
plural "false"
caps "false"
noprefix "false"

\end_inset

 , where each bin of the TDL is mapped to a value in picoseconds, which
 represents the propagation time of the input signal across that specific
 bin.
 
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figure/CT.png
	width 50col%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Calibration Table for each one of the three channels.
\begin_inset CommandInset label
LatexCommand label
name "fig:Calibration-Table."

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

To obtain high precision in the timestamp measure, we want this CT to be
 the more flat possible, meaning that no ultra-bin is present.
 Otherwise, we can adopt the Super Wave Union algorithm described before
 so to reduce the ultra-bin and flatten the CT.
 A block diagram representation of the generic channel that composes the
 TDC IP-Core in represented in Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Block_representation"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename figure/architecture_tdc.png
	lyxscale 20
	width 100col%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Block diagram of a single channel composing the TDC IP-Core.
\begin_inset CommandInset label
LatexCommand label
name "fig:Block_representation"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
All the performances of this TDC implementation are reported in Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:Tab1-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement b
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Achievable performance of the TDC IP-Core
\begin_inset CommandInset label
LatexCommand label
name "tab:Tab1-1"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="3">
<features booktabs="true" tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Feature
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7-Series
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ultrascale/Ultrascale+
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Num.
 of Chs
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
From 1 to 16
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Clock TDC Freq.
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
400 MHz
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
500 MHz
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Max.
 Channel Rate
\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
200 MHz
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Resolution (LSB)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
From 0.3 to 150 ps
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
From 0.24 to 125 ps
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Full-Scale Range (FSR)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
From 40 ns to 10 s
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
From 32 ns to 8 s
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
btprint "btPrintCited"
bibfiles "References"
options "IEEEtran"

\end_inset


\end_layout

\end_body
\end_document
